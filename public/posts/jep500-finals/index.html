<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>JEP 500: Prepare Final Mean Final | Ron&#39;s Tech Blog</title>
<meta name="keywords" content="Java, JEP, Java 26">
<meta name="description" content="
When you have been writing Java for a while, you may have noticed that you are writing final a lot.
You typically use it when defining class or instance variables. In those situations the compiler will ensure that need to assign a value before the class constructor completes.
Or you could use it with parameters, to indicate that the values of these parameters should not be tinkered with.
It is Java&rsquo;s version of defining a constant. Or at least, that is what we have been thinking.
But in real life, a final variable can be changed.
Take a look at the following example:">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/jep500-finals/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/jep500-finals/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Ron&#39;s Tech Blog (Alt + H)">Ron&#39;s Tech Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/shorts/" title="Shorts">
                    <span>Shorts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/books/" title="Books">
                    <span>Books</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      JEP 500: Prepare Final Mean Final
    </h1>
    <div class="post-meta"><span title='2025-12-29 00:00:00 +0000 UTC'>December 29, 2025</span>

</div>
  </header> 
  <div class="post-content"><p><img alt="Final" loading="lazy" src="/images/jep500-Finals.jpg"></p>
<p>When you have been writing Java for a while, you may have noticed that you are writing <code>final</code> a lot.
You typically use it when defining class or instance variables. In those situations the compiler will ensure that need to assign a value before the class constructor completes.
Or you could use it with parameters, to indicate that the values of these parameters should not be tinkered with.</p>
<p>It is Java&rsquo;s version of defining a constant. Or at least, that is what we have been thinking.
But in real life, a final variable can be changed.
Take a look at the following example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Field</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MutableFinal</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DataHolder</span><span class="w"> </span><span class="n">holder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataHolder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataHolder</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;message&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">field</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">field</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Updated via Reflection&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">holder</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">DataHolder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="s">&#34;Original Message&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getMessage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Now, this only works for a number of reasons. The most important is that we use <code>new String(&quot;Original Message&quot;)</code>. If not, the compiler would have replaced every mention of <code>message</code> with <code>&quot;Original Message&quot;</code>.
But by creating it at runtime, the JVM will look at the memory address of the <code>DataHolder</code> instance and there we have just changed its value.
There are other ways to achieve this, for instance, by using the Unsafe API.</p>
<h3 id="why-this-works-historically">Why This Works (Historically)<a hidden class="anchor" aria-hidden="true" href="#why-this-works-historically">#</a></h3>
<ul>
<li>setAccessible(true) disables Java language access checks</li>
<li>The JVM historically allowed reflective writes to final fields</li>
<li>No bytecode verification prevented this mutation</li>
</ul>
<h3 id="why-this-is-a-real-problem">Why This Is a Real Problem<a hidden class="anchor" aria-hidden="true" href="#why-this-is-a-real-problem">#</a></h3>
<p>At first glance, reflective mutation of final fields feels like an edge case. Something only frameworks or “clever hacks” rely on.
But the consequences are bigger than that.</p>
<h4 id="it-breaks-reasoning">It breaks reasoning<a hidden class="anchor" aria-hidden="true" href="#it-breaks-reasoning">#</a></h4>
<p>If a final field can change at runtime, code becomes harder to understand and debug—especially in concurrent systems.</p>
<h4 id="it-weakens-the-java-memory-model">It weakens the Java Memory Model<a hidden class="anchor" aria-hidden="true" href="#it-weakens-the-java-memory-model">#</a></h4>
<p>Final fields get special visibility guarantees. Mutating them after construction undermines those guarantees in subtle and dangerous ways.</p>
<h4 id="it-limits-jvm-optimizations">It limits JVM optimizations<a hidden class="anchor" aria-hidden="true" href="#it-limits-jvm-optimizations">#</a></h4>
<p>The JVM wants to trust that final values stay constant. If it cannot, it must be conservative, which means fewer optimizations and worse performance.</p>
<p>Simply put: the platform has been paying a high price for this loophole.</p>
<h2 id="enter-jep-500">Enter JEP 500<a hidden class="anchor" aria-hidden="true" href="#enter-jep-500">#</a></h2>
<p>With JEP-500, final finally(!) becomes fina.
But it will not suddenly break your application.
Instead, it introduces something Java has been missing for a long time: honesty.</p>
<p>Starting with JDK 26, when code tries to mutate a final field via reflection:</p>
<ul>
<li>The mutation still happens</li>
<li>But the JVM emits a warning (once per module)
That is it. No failures. No forced rewrites. Just visibility.</li>
</ul>
<p>This approach gives teams time to understand what their code—and their dependencies—are really doing.</p>
<h3 id="making-unsafe-behavior-a-choice">Making Unsafe Behavior a Choice<a hidden class="anchor" aria-hidden="true" href="#making-unsafe-behavior-a-choice">#</a></h3>
<p>JEP 500 also introduces new JVM options that put developers in control.</p>
<p>To enable final field mutation by any code on the classpath, use:
<code>--enable-final-field-mutation=ALL-UNNAMED</code></p>
<p>To enable final field mutation by specific modules on the module path, pass a comma-seperated list of modules:
<code>--enable-final-field-mutation=Mod1,Mod2,Mod3</code></p>
<p>Now, if an illegal final mutation is discovered, meaning some code that is not on the exempt list of the above command-line options tries to modify a final field, the action that the JVM takes differs, depending on the setting of another command-line option:</p>
<p><code>--enable-final-field-mutation=</code></p>
<ul>
<li>
<p>warn (default)
“Tell me when this happens.”</p>
</li>
<li>
<p>deny
“Fail fast. This should never happen in my code.”</p>
</li>
<li>
<p>allow
“I know this is unsafe, but I accept it.”</p>
</li>
</ul>
<p>The key shift here is philosophical: unsafe behavior is no longer silent. <strong>If you rely on it, you must opt in</strong>.</p>
<h3 id="legacy-code-is-not-ignored">Legacy Code Is Not Ignored<a hidden class="anchor" aria-hidden="true" href="#legacy-code-is-not-ignored">#</a></h3>
<p>Java knows the real world is messy.
Some libraries still rely on reflective final field mutation—for deserialization, proxying, or legacy injection patterns. JEP 500 allows teams to explicitly enable this behavior for:</p>
<ul>
<li>The classpath</li>
<li>Specific modules</li>
</ul>
<p>This makes technical debt explicit and localized, instead of invisible and global.</p>
<h3 id="finally-observability">Finally, Observability<a hidden class="anchor" aria-hidden="true" href="#finally-observability">#</a></h3>
<p>One of the most practical improvements in JEP 500 is its integration with Java Flight Recorder.
Each time a final field is mutated reflectively, a JFR event can be recorded. That means you can:</p>
<ul>
<li>Identify which library is responsible</li>
<li>See where it happens</li>
<li>Measure how often it occurs</li>
</ul>
<p>For the first time, this behavior is no longer a black box.</p>
<h3 id="what-this-means-for-frameworks">What This Means for Frameworks<a hidden class="anchor" aria-hidden="true" href="#what-this-means-for-frameworks">#</a></h3>
<p>Framework authors will feel this change first.
Libraries that rely on mutating final fields after construction will need to adapt. In most cases, better alternatives already exist:</p>
<ul>
<li>Constructor injection instead of field injection</li>
<li>Code generation instead of reflection</li>
<li>Explicit APIs instead of “magic” initialization</li>
</ul>
<p>The result will likely be simpler, more predictable frameworks—and fewer surprises for users.</p>
<h3 id="what-you-should-do-as-a-developer">What You Should Do as a Developer<a hidden class="anchor" aria-hidden="true" href="#what-you-should-do-as-a-developer">#</a></h3>
<p>You do not need to panic. But you should prepare.
A sensible approach:</p>
<ul>
<li>Run your application on JDK 26</li>
<li>Watch for warnings</li>
<li>Enable stricter modes in tests</li>
<li>Track updates from your dependencies</li>
<li>Avoid writing new code that mutates final fields reflectively</li>
</ul>
<p>These steps are small, but they future-proof your codebase.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/java/">Java</a></li>
      <li><a href="http://localhost:1313/tags/jep/">JEP</a></li>
      <li><a href="http://localhost:1313/tags/java-26/">Java 26</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Ron&#39;s Tech Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
